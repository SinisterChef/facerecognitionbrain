"use strict";(self.webpackChunkfacerecognitionbrain=self.webpackChunkfacerecognitionbrain||[]).push([[4060],{4060:(t,e,n)=>{n.d(e,{SoundsInstance:()=>c});var i=n(4409),s=n(4206);const o=1;function a(t){var e,n;const i=document.createElement("img"),{clickCb:s,container:a,display:u,iconOptions:c,margin:l,options:r,pos:d,rightOffsets:h}=t,{width:m,path:_,style:p,svg:v}=c;!function(t,e,n,i,s,a,u,c){t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.position="absolute",t.style.top="".concat(e+u,"px"),t.style.left="".concat(n-u-a,"px"),t.style.display=i,t.style.zIndex="".concat(s+o),t.style.cssText+=c}(i,d.top+l,d.right-(l*(h.length+1)+m+h.reduce(((t,e)=>t+e),0)),u,r.fullScreen.zIndex+o,m,l,p),i.src=null!==_&&void 0!==_?_:v?"data:image/svg+xml;base64,".concat(btoa(v)):"";return(null!==(e=null===(n=a.canvas.element)||void 0===n?void 0:n.parentNode)&&void 0!==e?e:document.body).append(i),i.addEventListener("click",(()=>{s()})),i}function u(t){t&&t.remove()}class c{constructor(t,e){this._addBuffer=t=>{const e=t.createBufferSource();return this._audioSources.push(e),e},this._addOscillator=t=>{const e=t.createOscillator();return this._audioSources.push(e),e},this._initEvents=()=>{const t=this._container,e=t.actualOptions.sounds;if(null!==e&&void 0!==e&&e.enable&&t.canvas.element)for(const n of e.events){const t=e=>{(async()=>{const s=n.filter&&!n.filter(e);if(this._container!==e.container)return;if(!this._container||this._container.muted||this._container.destroyed)return void(0,i.wJ)(n.event,(e=>{this._engine.removeEventListener(e,t)}));if(s)return;if(n.audio)this._playBuffer((0,i.TA)(n.audio));else if(n.melodies){const t=(0,i.Vh)(n.melodies);t.melodies.length?await Promise.allSettled(t.melodies.map((e=>this._playNote(e.notes,0,t.loop)))):await this._playNote(t.notes,0,t.loop)}else if(n.notes){const t=(0,i.Vh)(n.notes);await this._playNote([t],0,!1)}})()};(0,i.wJ)(n.event,(e=>{this._engine.addEventListener(e,t)}))}},this._mute=async()=>{const t=this._container,e=this._getAudioContext();for(const n of this._audioSources)this._removeAudioSource(n);this._gain&&this._gain.disconnect(),await e.close(),t.audioContext=void 0,this._engine.dispatchEvent("soundsMuted",{container:this._container})},this._playBuffer=t=>{var e;const n=this._audioMap.get(t.source);if(!n)return;const i=this._container.audioContext;if(!i)return;const s=this._addBuffer(i);s.loop=t.loop,s.buffer=n,s.connect(null!==(e=this._gain)&&void 0!==e?e:i.destination),s.start()},this._playFrequency=async(t,e)=>{if(!this._gain||this._container.muted)return;const n=this._getAudioContext(),i=this._addOscillator(n);return i.connect(this._gain),i.type="sine",i.frequency.value=t,i.start(),new Promise((t=>{setTimeout((()=>{this._removeAudioSource(i),t()}),e)}))},this._playMuteSound=()=>{if(this._container.muted)return;const t=this._getAudioContext(),e=t.createGain();e.connect(t.destination),e.gain.value=0;const n=t.createOscillator();n.connect(e),n.type="sine",n.frequency.value=1,n.start(),setTimeout((()=>{n.stop(),n.disconnect(),e.disconnect()}))},this._playNote=async(t,e,n)=>{if(this._container.muted)return;const s=t[e];if(!s)return;const o=s.value,a=(0,i.wJ)(o,(async(n,i)=>this._playNoteValue(t,e,i)));await((0,i.cy)(a)?Promise.allSettled(a):a);let u=e+1;n&&u>=t.length&&(u%=t.length),this._container.muted||await this._playNote(t,u,n)},this._playNoteValue=async(t,e,n)=>{const o=t[e];if(!o)return;const a=(0,i.TA)(o.value,n,!0);try{const t=(0,s.jE)(a);if(!(0,i.Et)(t))return;await this._playFrequency(t,o.duration)}catch(u){(0,i.tZ)().error(u)}},this._removeAudioSource=t=>{t.stop(),t.disconnect();this._audioSources.splice(this._audioSources.indexOf(t),1)},this._unmute=()=>{const t=this._container.actualOptions.sounds;if(!t)return;const e=this._getAudioContext();this._audioSources||(this._audioSources=[]);const n=e.createGain();n.connect(e.destination),n.gain.value=t.volume.value/i.a5,this._gain=n,this._initEvents(),this._engine.dispatchEvent("soundsUnmuted",{container:this._container})},this._updateMuteIcons=()=>{const t=this._container,e=t.actualOptions.sounds;if(null===e||void 0===e||!e.enable||!e.icons.enable)return;const n=this._muteImg,i=this._unmuteImg;n&&(n.style.display=t.muted?"block":"none"),i&&(i.style.display=t.muted?"none":"block")},this._updateMuteStatus=async()=>{const t=this._container,e=this._getAudioContext();t.muted?(await(null===e||void 0===e?void 0:e.suspend()),await this._mute()):(await(null===e||void 0===e?void 0:e.resume()),this._unmute(),this._playMuteSound())},this._updateVolume=async()=>{var t;const e=this._container,n=e.actualOptions.sounds;if(null===n||void 0===n||!n.enable)return;(0,i.qE)(this._volume,n.volume.min,n.volume.max);let s=!1;this._volume<=0&&!e.muted?(this._volume=0,e.muted=!0,s=!0):this._volume>0&&e.muted&&(e.muted=!1,s=!0),s&&(this._updateMuteIcons(),await this._updateMuteStatus()),null!==(t=this._gain)&&void 0!==t&&t.gain&&(this._gain.gain.value=this._volume/i.a5)},this._container=t,this._engine=e,this._volume=0,this._audioSources=[],this._audioMap=new Map}async init(){const t=this._container.actualOptions.sounds;if(null===t||void 0===t||!t.enable)return;if(t.autoPlay&&(0,s.E3)()){const t=()=>{removeEventListener(i.ms,t),removeEventListener(i.s7,t),(0,s.XK)(),this.unmute()},e={capture:!0,once:!0};addEventListener(i.ms,t,e),addEventListener(i.s7,t,e)}this._volume=t.volume.value;const e=t.events;this._audioMap=new Map;for(const n of e){if(!n.audio)continue;const t=(0,i.wJ)(n.audio,(async t=>{const e=await fetch(t.source);if(!e.ok)return;const n=await e.arrayBuffer(),i=this._getAudioContext(),s=await i.decodeAudioData(n);this._audioMap.set(t.source,s)}));t instanceof Promise?await t:await Promise.allSettled(t)}}async mute(){this._container.muted||await this.toggleMute()}async start(){const t=this._container,e=t.actualOptions,n=e.sounds;if(null===n||void 0===n||!n.enable||!t.canvas.element)return;t.muted=!0;const i=t.canvas.element,o={top:i.offsetTop,right:i.offsetLeft+i.offsetWidth},{mute:u,unmute:c,volumeDown:l,volumeUp:r}=n.icons,d=async()=>{await this.toggleMute()},h=n.icons.enable?"block":"none";this._muteImg=a({container:t,options:e,pos:o,display:h,iconOptions:u,margin:10,rightOffsets:[l.width,r.width],clickCb:d}),this._unmuteImg=a({container:t,options:e,pos:o,display:"none",iconOptions:c,margin:10,rightOffsets:[l.width,r.width],clickCb:d}),this._volumeDownImg=a({container:t,options:e,pos:o,display:h,iconOptions:l,margin:10,rightOffsets:[r.width],clickCb:async()=>{await this.volumeDown()}}),this._volumeUpImg=a({container:t,options:e,pos:o,display:h,iconOptions:r,margin:10,rightOffsets:[],clickCb:async()=>{await this.volumeUp()}}),!(0,s.E3)()&&n.autoPlay&&await this.unmute()}stop(){this._container.muted=!0,(async()=>{await this._mute(),u(this._muteImg),u(this._unmuteImg),u(this._volumeDownImg),u(this._volumeUpImg)})()}async toggleMute(){const t=this._container;t.muted=!t.muted,this._updateMuteIcons(),await this._updateMuteStatus()}async unmute(){this._container.muted&&await this.toggleMute()}async volumeDown(){const t=this._container,e=t.actualOptions.sounds;null!==e&&void 0!==e&&e.enable&&(t.muted&&(this._volume=0),this._volume-=e.volume.step,await this._updateVolume())}async volumeUp(){const t=this._container.actualOptions.sounds;null!==t&&void 0!==t&&t.enable&&(this._volume+=t.volume.step,await this._updateVolume())}_getAudioContext(){const t=this._container;return t.audioContext||(t.audioContext=new AudioContext),t.audioContext}}}}]);
//# sourceMappingURL=4060.b373dfff.chunk.js.map